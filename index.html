<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>CloverPit Companion</title>
<link rel="manifest" href="manifest.webmanifest?v=2025-10-02-14">
<link rel="stylesheet" href="style.css?v=2025-10-02-14">
<script>(function(){if(window.__cpit_boot)return;window.__cpit_boot={ok:false,errs:[]};function el(){var e=document.getElementById('cpit_err_badge');if(e)return e;e=document.createElement('div');e.id='cpit_err_badge';e.innerHTML='<div class="t">⚠️ Startproblem</div><div class="m"></div><button id="cpit_copy">Details kopieren</button>';document.documentElement.appendChild(e);return e}function msg(x){try{return typeof x==='string'?x:(x&&x.stack)||x.message||JSON.stringify(x)}catch(e){return'Startfehler'}}function show(m){var e=el();e.querySelector('.m').textContent=m;document.getElementById('cpit_copy').onclick=function(){navigator.clipboard.writeText(window.__cpit_boot.errs.join('\n'))}}function rep(k,err){var m='['+k+'] '+msg(err);window.__cpit_boot.errs.push(m);show(m);}window.addEventListener('error',function(e){rep('error',e.error||e.message||e)});window.addEventListener('unhandledrejection',function(e){rep('unhandledrejection',e.reason||e)});})();</script>
</head>
<body>
<div class="wrap">
<h1>CloverPit Companion</h1>
<div id="versionBadge"></div>
<input id="coins" type="number" placeholder="Münzen">
<input id="tickets" type="number" placeholder="Tickets">
<ul id="charmList" class="charm-list"></ul>
</div>
<script>
(function(){
var VERSION='2025-10-02-14';
function bust(u){return u+(u.indexOf('?')>=0?'&':'?')+'v='+VERSION;}

if('serviceWorker'in navigator){navigator.serviceWorker.register('./service-worker.js',{updateViaCache:'none'});}

function checkVersion(){fetch(bust('version.json'),{cache:'no-store'}).then(function(r){return r.json()}).then(function(d){var el=document.getElementById('versionBadge');el.textContent='v '+((d&&d.version)||'');});}
checkVersion();

var store={load:function(){try{return JSON.parse(localStorage.getItem('cpit')||'{}');}catch(e){return {};}},
           save:function(d){localStorage.setItem('cpit',JSON.stringify(d));}};
var state=Object.assign({coins:0,tickets:0,owned:{}},store.load());

document.getElementById('coins').value=state.coins;
document.getElementById('tickets').value=state.tickets;
document.getElementById('coins').addEventListener('input',function(e){state.coins=+e.target.value||0;store.save(state);});
document.getElementById('tickets').addEventListener('input',function(e){state.tickets=+e.target.value||0;store.save(state);});

fetch(bust('charms.json')).then(function(r){return r.json()}).then(function(chars){var ul=document.getElementById('charmList');chars.forEach(function(c){var li=document.createElement('li');var cb=document.createElement('input');cb.type='checkbox';cb.checked=!!state.owned[c.id];cb.onchange=function(e){state.owned[c.id]=e.target.checked;store.save(state);};li.appendChild(cb);li.appendChild(document.createTextNode(' '+c.name+' – '+c.effect));ul.appendChild(li);});});
})();
</script>
</body></html>
